<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Socket.IO chat</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
  </head>
  <body>
    <div style="float: left; width: 50%">
      <button type="button" class="btn btn-warning" onclick="socket.emit('button press');">RNGesus take the wheel</button>
      <br />
      <canvas id="board"></canvas>
      <br/>
      <button type="button" class="btn btn-warning" onclick="socket.emit('new game', document.cookie);">New game</button>
    </div>
    <div style="float: right; width: 50%">
<div class="container">
    <div class="row">
        <div class="col-md-5">
            <div class="panel panel-primary">
                <div class="panel-heading" id="accordion">
                    <span class="glyphicon glyphicon-comment"></span> Chat
                    <div class="btn-group pull-right">
                        <a type="button" class="btn btn-default btn-xs" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                            <span class="glyphicon glyphicon-chevron-down"></span>
                        </a>
                    </div>
                </div>
            <div class="panel-collapse collapse in" id="collapseOne">
                <div class="panel-body">
                    <ul id="chat">
                    </ul>
                </div>
                <div class="panel-footer">
                    <div class="input-group">
                        <form action="">
                            <input id="m" autocomplete="off" />
                        </form>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>
</div>
        </div>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="https://raw.github.com/leizongmin/js-xss/master/dist/xss.js"></script>
    <script>
function getDateTime() {
    var date = new Date();
    var hour = date.getHours();
    hour = (hour < 10 ? "0" : "") + hour;
    var min  = date.getMinutes();
    min = (min < 10 ? "0" : "") + min;
    return hour+":"+min;
}
      var socket = io();
      $('form').submit(function(){
        socket.emit('chat message', $('#m').val());
        $('#m').val('');
        return false;
      });
      socket.on('chat message', function(msg){
        $('#chat').append('<li class=\"left clearfix\"><span class=\"chat-img pull-left\"><img src=\"http://placehold.it/50/55C1E7/fff&text=U\" alt=\"User Avatar\" class=\"img-circle\" /></span><div class=\"chat-body clearfix\"><div class=\"header\"><strong class=\"primary-font\">Jack Black</strong><small class=\"pull-right text-muted\"><span class=\"glyphicon glyphicon-time\"></span>'+ getDateTime() +'</small></div><p>'+ "&nbsp&nbsp" + (filterXSS(msg)) + '</p></div></li>');
      });

     socket.on('matched', function(opponentID){
        alert("Matched with: " + opponentID);
      });
      socket.on('invalid cookie', function() {
        alert("Invalid cookie!");
      });
      socket.on('button press', function(){
        $('messages').append('Button Pressed');
      });
      socket.on('draw', function(imagedata){
        console.log(imagedata);
        var canvas = document.getElementById('board');
        var ctx = canvas.getContext('2d');
        var img = new Image();
        var src = 'data:image/svg+xml;base64,'+window.btoa(imagedata);
        img.onload = function() {
          ctx.drawImage(img, 0, 0);
        }
        img.src = src;
      })
    </script>
  <link rel="stylesheet" href="index.css">
  </body>
</html>
